---
title: "U.S. Beef Industry"
author: "Erdal Erol"
date: "`r Sys.Date()`"
output: 
  rmdformats::html_clean:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: true
    highlight: tango
---

<style>
body {
text-align: justify}
</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE, warning= FALSE, message = FALSE, global.true=TRUE)
```

```{r klippy, echo=FALSE, include=TRUE}
#remotes::install_github("rlesur/klippy")
klippy::klippy(position = c('top', 'right'))
```

```{r,include=FALSE}
par(mar=c(10,10,0,0))
``` 

# Synopsis

# Packages Required
This project aims to provide a snapchsot of U.S. beef industry with R data wrangling, visualization and mapping functions and techniques. 
The most common functions in  *tidyverse*, *data.table*, *ggplot2*, and *usmap* are employed. The package *DT* is used to provide tables for R markdown output. 

```{r packages}
#install.packages("...")
#data wrangling
library(tidyverse)
library(dtplyr)
library(tidyfast)
library(data.table)
#plots
library(ggplot2)
library(ggrepel)
#R interface/JavaScript-DataTables
library(DT)
#load excel files
library(readxl)
#animated  plots
library(png)
library(gifski)
library(gganimate)
#mapping
library(usmap)
#USDA data with API
library(tidyUSDA)
```

# 1. Introduction

United States is the largest producer and consumer of beef in the world with 20% of the global beef production. The main stages of beef-cattle production process in U.S. are cow-calf operations, stocker/backgrounding operations, feedlots, meat packers and processors, and retailers. The production process begins with the cow-calf farms where cows and calves are raised. The next stage of production occurs at stocker/backgrounding operations where calves are placed on grass or other type of roughage. Feedlots are the final chain in the cattle production and they feed cattle with different rations of grain, silage, and/or protein supplements and sell to beef packers and processors where beef and beef by-products are produced and sold to retailers. The economic size of beef-cattle industry including direct and indirect economic contributions during on-farm and post-farm activities is estimated as $167 billion in 2016 [<a href="https://www.mdpi.com/2071-1050/14/8/4391/htm" target="_blank">1</a>]. 

This project aims to present a macro picture of the industry with 4 main variables: Production, international trade, price, and consumption. Production and international trade sections include both cattle and beef sectors' data. Prices are for farm, wholesale, and retail levels. Consumption figures are per capita values and compared with pork and chicken per capita values.


# 2. Data


## 2.1. Data Sources
The data source is <a href="https://quickstats.nass.usda.gov/" target="_blank">USDA National Agricultural Statistics Service</a>.

## 2.2. Data Preparation

*Production*

* Cattle
```{r}
cattleinv_data_yearly =  read_csv("data/beef_inv_yearly.csv")

cattleinv_data_2021 =  read_csv("data/2021_beef_cattle_inv_state.csv")
```

```{r}
cattleinv_data_state_year =  read_csv("data/beef_inv_state_year.csv")
```

```{r}
cattleinv_data_county =  read_csv("data/beef_inv_county_2021.csv")
```


* Beef
```{r}
beef_prod_data = read_excel("data/yearly beef production.xlsx")
```

*Trade* 

* Cattle

* Export 
```{r}
export_data_cattle = read_excel("data/cattle_trade.xlsx", sheet = "export")

export_data_cattle = melt(export_data_cattle, id.vars ="country",
variable.name = "year", value.name = "export")

export_data_cattle = as.data.table(export_data_cattle, key="country")
export_data_cattle[, export:=export/1000]
```

* Import
```{r}
import_data_cattle = read_excel("data/cattle_trade.xlsx", sheet = "import")

import_data_cattle = melt(import_data_cattle, id.vars ="country",
variable.name = "year", value.name = "import")

import_data_cattle = as.data.table(import_data_cattle, key = "country")

import_data_cattle[, import:=import/1000]
```

* Beef

* Export
```{r}
export_data <- read_excel("data/beef_trade.xlsx", sheet = "export")

export_data = melt(export_data, id.vars ="country",
variable.name = "year", value.name = "export")

export_data = as.data.table(export_data, key="country")
export_data[, export := export/1000]
```

* Import
```{r}
import_data <- read_excel("data/beef_trade.xlsx", sheet = "import")

import_data = melt(import_data, id.vars ="country",
variable.name = "year", value.name = "import")

import_data = as.data.table(import_data, key = "country")
import_data[, import:=import/1000]
```

*Prices*
```{r}
beef_price_data = read_excel("data/prices.xlsx")
```

*Consumption*
```{r}
beef_consmptn_data = read_excel("data/beef_consumption.xls")
```


# 3. Beef Industry
## 3.1. Production
### 3.1.1. Cattle

```{r}
table_data = as.data.table(cattleinv_data_yearly)
table_data %>%
  .[, Value:=Value/1000]%>%
  .[, pct_change := (Value/lead(Value) - 1)]%>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 1: U.S. Beef Cattle Inventory')
  ), colnames = c('Year', '# of Heads-1000', 'Annual Change'))%>%
  formatCurrency('Value',currency = "", interval = 3, mark = ",", digits = 0)%>%
  formatPercentage('pct_change', 1)

dt = 
  table_data %>% 
  as.data.frame(dt)  %>%
  select(Year, Value) %>%
  gather(key = "variable", value = "Inventory", -Year)

ggplot(dt, aes(x = Year, y = Inventory)) + 
  labs(title = "U.S. Beef Cattle Inventory-1000 heads") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange")) +
  theme_minimal()


dt = 
  table_data %>% 
  as.data.frame(dt)  %>%
  select(Year, pct_change) %>%
  gather(key = "variable", value = "Change", -Year)

ggplot(table_data, aes(x = Year, y = `pct_change`)) + 
  labs(title = "U.S. Beef Cattle Inventory-% change") +
  geom_line(color="orange") +
  theme_minimal()
```


```{r}
table_data = as.data.table(cattleinv_data_2021)
table_data %>%
  .[order(-Value)]%>% 
  .[, Value:=Value/1000]%>%
  .[, state_share := (Value/sum(Value))]%>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 2: U.S. Beef Cattle Inventory by State - 2021')
  ), colnames = c('State', '# of Heads-1000', 'State Share'))%>%
  formatCurrency('Value',currency = "", interval = 3, mark = ",", digits=0)%>%
  formatPercentage('state_share', 1)


setnames(cattleinv_data_2021,"State","state")
plot = 
  plot_usmap(data = cattleinv_data_2021, values = "Value", labels = TRUE,  color = "black")  + 
  scale_fill_continuous(name = "Beef Cattle Inventory",  low = "white", high = "cornflowerblue", label = scales::comma) + 
  labs(title = "U.S. Beef Cattle Inventory by State, 2021-heads") +
  theme(legend.position = "right")

# Set label font size
plot$layers[[2]]$aes_params$size <- 1.5
print(plot)

```


```{r}
table_data = as.data.table(cattleinv_data_state_year)
table_data %>%
  .[, c("Year", "State", "Value")] %>%
  .[, Value:=Value/1000]%>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 3: U.S. Beef Cattle Inventory by State: 1920-2022')
  ), colnames = c('Year','State', '# of Heads-1000'))%>%
  formatCurrency('Value',currency = "", interval = 3, mark = ",", digits = 0)


table_data = table_data[Year>1972]
setnames(table_data,  "State", "state")

plot = 
  plot_usmap(data = table_data, values = "Value", labels = FALSE)  + 
  scale_fill_continuous(name = "Beef Cattle Inventory",  low = "white", high = "cornflowerblue", label = scales::comma) + 
  theme(legend.position = "right")+
    labs(title= "U.S. Beef Cattle Inventory by State: 1972-2022" ,subtitle = 'Year: {closest_state}')+
   transition_states(Year)

animate(plot, fps = 5)

```

```{r}
cattleinv_data_county =  read_csv("data/beef_inv_county_2021.csv")
table_data = as.data.table(cattleinv_data_county)
table_data %>%
  .[order(-Value)] %>%
  .[, c("State", "County","Value")] %>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 4: U.S. Beef Cattle Inventory by County- January 1, 2021')
  ), colnames = c('State','County','# of Heads'))%>%
  formatCurrency('Value',currency = "", interval = 3, mark = ",", digits = 0)

```


### 3.1.2. Beef

```{r}
table_data = as.data.table(beef_prod_data[, -c(3:10), with=FALSE])
table_data %>%
  .[order(-year)]%>% 
  .[, pct_change := (production/lead(production) - 1)]%>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 5: U.S. Beef Production')
  ), colnames = c('Year', 'Million pounds', 'Annual Change'))%>%
  formatCurrency('production',currency = "", interval = 3, mark = ",", digits = 0)%>%
  formatPercentage('pct_change', 1)

dt = 
  beef_prod_data[, -c(3:10), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  select(year, production) %>%
  gather(key = "variable", value = "value", -year)

ggplot(dt, aes(x = year, y = value)) + 
  labs(title = "U.S. Beef Production-1000 pounds") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange")) +
  theme_minimal()

dt = 
  beef_prod_data[, -c(3:10), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  mutate(pct_change = (production/lead(production) - 1)*100)%>%
  select(year, pct_change) %>%
  gather(key = "variable", value = "Change", -year)

ggplot(dt, aes(x = year, y = Change)) + 
  labs(title = "U.S. Beef Production-% Annual Change") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange")) +
  theme_minimal()

```



```{r}

cattle_gif_data = as.data.table(cattleinv_data_yearly[1:52,])
setkey(cattle_gif_data,Year) 
setnames(cattle_gif_data,  "Value", "Cattle_Inventory")

beef_prod_gif_data = as.data.table(beef_prod_data[1:52, -c(3:10), with=FALSE])
setnames(beef_prod_gif_data,  "year", "Year")
setnames(beef_prod_gif_data,  "production", "Beef_Production")
beef_prod_gif_data= beef_prod_gif_data[, Beef_Production:=Beef_Production*1000]

gif_data = merge(cattle_gif_data, beef_prod_gif_data, all = TRUE)
gif_data[, Beef_per_Cow := (Beef_Production/Cattle_Inventory)]

dt = 
  gif_data%>% 
  as.data.frame(dt)  %>%
  select(Year, Cattle_Inventory, Beef_Production ) %>%
  gather(key = "variable", value = "value", -Year)

ggplot(dt, aes(x = Year, y = value)) + 
  labs(title = "U.S. Cattle Inventory and Beef Production, 1970-2021") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange", "lightblue")) +
  theme_minimal()+
  transition_reveal(Year)

```


```{r}
gif_data[, Beef_per_Cow := (Beef_Production/Cattle_Inventory)]

gif_data=gif_data %>%mutate_at(c(2:4), funs(c(scale(.))))

scaled_data = scale(gif_data)

dt = 
  gif_data%>% 
  as.data.frame(dt)  %>%
  select(Year, Cattle_Inventory, Beef_Production, Beef_per_Cow ) %>%
  gather(key = "variable", value = "value", -Year)

ggplot(dt, aes(x = Year, y = value)) + 
  labs(title = "U.S. Cattle Inventory and Beef Production, 1970-2021") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange", "lightblue", "red")) +
  theme_minimal()+
  transition_reveal(Year)
```


## 3.2. International Trade
### 3.2.1. Cattle 

*Export*

```{r}
cattle_exports = export_data_cattle[year =="2021"]
setorderv(cattle_exports, cols="export",  order=-1L, na.last=TRUE)
#head(cattle_exports,10)
```

```{r}
data= cattle_exports[2:111]
data= data[, c("year"):=NULL]

data[, export:=round(export*100/509.576, digits = 1)]
setnames(data,  "export", "export_share")

rest_total = sum(data$export[6:111], na.rm = T)  
rest_totw <- data.frame("restoftheworld", rest_total)      
names(rest_totw) = c("country", "export_share")

data= data[1:5]

data1 = rbind(data, rest_totw) 

table_data = setorderv(data1, cols="export_share",  order=-1L, na.last=TRUE)

knitr::kable(
  table_data[1:6],
  col.names = c('Country', 'Share-%'),
  align = "lccrr",
  caption = "Table 6: U.S. Cattle Exports by Country"
)

#labels
data2 <- data1 %>% 
  mutate(csum = rev(cumsum(rev(export_share))), 
         pos = export_share/2 + lead(csum, 1),
         pos = if_else(is.na(pos), export_share/2, pos))

data2 = as.data.frame(data2)
ggplot(data1, aes(x = "" , y = export_share, fill=fct_inorder(country))) +
  labs(title = "U.S. Cattle Exports by Country")+
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel1") +
  geom_label_repel(data = data2,
                   aes(y = pos, label = paste0(export_share, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Country")) +
  theme_void()

```

*Import*

```{r}
cattle_imports = import_data_cattle[year =="2021" ]
setorderv(cattle_imports, cols="import",  order=-1L, na.last=TRUE)
```

```{r}
data= cattle_imports[2:24]
data= data[, c("year"):=NULL]

data[, import:=round(import*100/1775.492, digits = 1)]
setnames(data,  "import", "import_share")

rest_total = sum(data$import[3:24], na.rm = T)  
rest_totw <- data.frame("restoftheworld", rest_total)      
names(rest_totw) = c("country", "import_share")

data= data[1:2]

data1 = rbind(data, rest_totw) 
table_data = setorderv(data1, cols="import_share",  order=-1L, na.last=TRUE)
knitr::kable(
  table_data[1:3],
  col.names = c('Country', 'Share-%'),
  align = "lccrr",
  caption = "Table 7: U.S. Cattle Imports by Country"
)

#labels
data2 <- data1 %>% 
  mutate(csum = rev(cumsum(rev(import_share))), 
         pos = import_share/2 + lead(csum, 1),
         pos = if_else(is.na(pos), import_share/2, pos))

data2 = as.data.frame(data2)
ggplot(data1, aes(x = "" , y = import_share, fill=fct_inorder(country))) +
  labs(title = "U.S. Cattle Imports by Country")+
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel1") +
  geom_label_repel(data = data2,
                   aes(y = pos, label = paste0(import_share, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Country")) +
  theme_void()

```


*Trade Balance*

```{r}
cattle_trade_data = merge( export_data_cattle,import_data_cattle, by = c("country", "year"), all=T)
cattle_trade_data = cattle_trade_data[, trade_balance:= export-import] 
cattle_trade_data = cattle_trade_data[, us_status:= ifelse(trade_balance<0, "net_importer", "net_exporter")] 
total_cattle_trade = cattle_trade_data[country=="total"]
setorder(total_cattle_trade, cols = -"year") 

table_data = as.data.table(total_cattle_trade)
table_data %>%
  .[, country:= NULL]%>%
  .[, trade_balance:=round(trade_balance, digits = 0)]%>%  
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 8: U.S. Cattle Trade-1000 heads')
  ), colnames = c('Year', 'Export', 'Import', 'Balance', 'Position'))%>%
  formatCurrency(c('export','import', 'trade_balance'), currency = "", interval = 3, mark = ",", digits=0)

```

### 3.2.2. Beef 

```{r}
dt = 
  beef_prod_data[, -c(3,5,7,8,9,10), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  select(year, import, export) %>%
  gather(key = "variable", value = "value", -year)

ggplot(dt, aes(x = year, y = value)) + 
  labs(title = "U.S. Beef Trade-1000 lbs") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange", "lightblue")) +
  theme_minimal()
```

*Export*
```{r}
beef_exports = export_data[year =="2021"]
setorderv(beef_exports, cols="export",  order=-1L, na.last=TRUE)
```

```{r}
data= beef_exports[2:217]
data= data[, c("year"):=NULL]

data[, export:=round(export*100/3447.0693	, digits = 1)]
setnames(data,  "export", "export_share")

rest_total = sum(data$export[11:217], na.rm = T)
rest_totw <- data.frame("restoftheworld", rest_total)      
names(rest_totw) = c("country", "export_share")

data= data[1:10]

data1 = rbind(data, rest_totw) 
table_data = setorderv(data1, cols="export_share",  order=-1L, na.last=TRUE)
knitr::kable(
  table_data[1:11],
  col.names = c('Country', 'Share-%'),
  align = "lccrr",
  caption = "Table 9: U.S. Beef Exports by Country"
)

#labels
data2 <- data1 %>% 
  mutate(csum = rev(cumsum(rev(export_share))), 
         pos = export_share/2 + lead(csum, 1),
         pos = if_else(is.na(pos), export_share/2, pos))

data2 = as.data.frame(data2)
ggplot(data1, aes(x = "" , y = export_share, fill=fct_inorder(country))) +
  labs(title = "U.S. Beef Exports Country Shares - %")+
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel1") +
  geom_label_repel(data = data2,
                   aes(y = pos, label = paste0(export_share, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Country")) +
  theme_void()
```

*Import*


```{r}
beef_imports = import_data[year =="2021"]
setorderv(beef_imports, cols="import",  order=-1L, na.last=TRUE)
```

```{r}
data= beef_imports[2:94]
data= data[, c("year"):=NULL]


data[, import:=round(import*100/3347.51555		, digits = 1)]
setnames(data,  "import", "import_share")

rest_total = sum(data$import[11:217], na.rm = T)
rest_totw <- data.frame("restoftheworld", rest_total)      
names(rest_totw) = c("country", "import_share")

data= data[1:10]
data1 = rbind(data, rest_totw) 

table_data = setorderv(data1, cols="import_share",  order=-1L, na.last=TRUE)
knitr::kable(
  table_data[1:11],
  col.names = c('Country', 'Share-%'),
  align = "lccrr",
  caption = "Table 9: U.S. Beef Imports by Country"
)

#labels
data2 <- data1 %>% 
  mutate(csum = rev(cumsum(rev(import_share))), 
         pos = import_share/2 + lead(csum, 1),
         pos = if_else(is.na(pos), import_share/2, pos))

data2 = as.data.frame(data2)
ggplot(data1, aes(x = "" , y = import_share, fill=fct_inorder(country))) +
  labs(title = "U.S. Cattle Imports Country Shares - %")+
  geom_col(width = 1, color = 1) +
  coord_polar(theta = "y") +
  scale_fill_brewer(palette = "Pastel1") +
  geom_label_repel(data = data2,
                   aes(y = pos, label = paste0(import_share, "%")),
                   size = 4.5, nudge_x = 1, show.legend = FALSE) +
  guides(fill = guide_legend(title = "Country")) +
  theme_void()
```


*Trade Balance*
```{r}
beef_trade_data = merge( export_data,import_data, by = c("country", "year"), all=T)
beef_trade_data = beef_trade_data[, trade_balance:= export-import] 
beef_trade_data = beef_trade_data[, us_status:= ifelse(trade_balance<0, "net_importer", "net_exporter")] 

beef_total_trade = beef_trade_data[country=="total" ]
setorder(beef_total_trade, cols = -"year") 

table_data = as.data.table(beef_total_trade)
table_data %>%
  .[, country:= NULL]%>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 10: U.S. Beef Trade-1000 pounds')
  ), colnames = c('Year', 'Export', 'Import', 'Balance', 'Position'))%>%
  formatCurrency(c('export','import', 'trade_balance'), currency = "", interval = 3, mark = ",", digits=0)

```

## 3.3. Prices

```{r}
table_data = as.data.table(beef_price_data[, -c(5:7)])
table_data %>%
  .[order(-date)]%>% 
  .[, date:=as.character(date)] %>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 11: U.S. Beef Prices- Cents per pound')
  ), colnames = c('Date', 'Farm','Wholesale','Retail'))%>%
  formatCurrency(c('farm','wholesale','retail'),currency = "", interval = 3, mark = ",", digits = 0)


dt = 
  beef_price_data[, -c(5:7), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  select(date, farm, wholesale, retail) %>%
  gather(key = "price", value = "value", -date)

ggplot(dt, aes(x = date, y = value)) + 
  labs(title = "U.S. Beef Prices-cents per pound") +
  geom_line(aes(color = price), size = 1) +
  scale_color_manual(values = c("orange", "lightblue", "lightgreen")) +
  theme_minimal()

```

```{r}
dt = 
  beef_price_data[, -c(5:7), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  select(date, farm, wholesale, retail) %>%
  gather(key = "price", value = "value", -date)

ggplot(dt, aes(x = date, y = value)) + 
  labs(title = "U.S. Beef Prices-cents per pound") +
  geom_line(aes(color = price), size = 1) +
  scale_color_manual(values = c("orange", "lightblue", "lightgreen")) +
  theme_minimal()+
  transition_reveal(date)
```

```{r}
table_data = as.data.table(beef_price_data[, -c(2:4)])
table_data %>%
  .[order(-date)]%>% 
  .[, date:=as.character(date)] %>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 12: U.S. Beef Price Spreads- Cents per pound')
  ), colnames = c('Date', 'Farm-Retail','Farm-Wholesale','Wholesale-Retail'))%>%
  formatCurrency(c('farm-retail','farm-wholesale','wholesale-retail'),currency = "", interval = 3, mark = ",", digits = 0)


dt = 
  beef_price_data[, -c(2:4), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  select(date, `farm-retail`, `farm-wholesale`, `wholesale-retail`) %>%
  gather(key = "spread", value = "value", -date)


ggplot(dt, aes(x = date, y = value)) + 
  labs(title = "U.S. Beef Price Spreads") +
  geom_line(aes(color = spread), size = 1) +
  scale_color_manual(values = c("orange", "lightblue", "lightgreen")) +
  theme_minimal()

```

## 3.4. Consumption

```{r}
table_data = as.data.table(beef_prod_data[, -c(2:8,10)])
table_data %>%
  .[order(-year)]%>% 
  .[, pct_change := (population/lead(population) - 1)]%>%
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 13: U.S. Popupation- Thousand')
  ), colnames = c('Year', 'Population','Annual Change'))%>%
  formatCurrency(c('population'),currency = "", interval = 3, mark = ",", digits = 0)%>%
  formatPercentage('pct_change', 1)


dt = 
  beef_prod_data[, -c(3,5,7,8,10), with=FALSE] %>% 
  as.data.frame(dt)  %>%
  select(year, population) %>%
  gather(key = "variable", value = "value", -year)

ggplot(dt, aes(x = year, y = value)) + 
  labs(title = "U.S. Population-Million") +
  geom_line(aes(color = variable), size = 1) +
  scale_color_manual(values = c("orange")) +
  theme_minimal()

```

```{r}
table_data = as.data.table(beef_consmptn_data)
table_data %>%
  .[order(-year)]%>% 
  datatable(table_data,caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;', htmltools::em('Table 14: U.S. Meat Consumption - per capita- pound')
  ), colnames = c('Year', 'Beef','Pork','Chicken'))%>%
  formatCurrency(c('beef','pork','chicken'),currency = "", interval = 3, mark = ",", digits = 0)


dt = 
  as.data.frame(beef_consmptn_data)  %>%
  select(year, beef, pork, chicken) %>%
  gather(key = "per capita consumption", value = "value", -year)

ggplot(dt, aes(x = year, y = value)) + 
  labs(title = "U.S. Meat Consumption-pounds") +
  geom_line(aes(color = `per capita consumption`), size = 1) +
  scale_color_manual(values = c("orange", "lightblue", "lightgreen")) +
  theme_minimal()
```

```{r}

dt = 
  as.data.frame(beef_consmptn_data)  %>%
  select(year, beef, pork, chicken) %>%
  gather(key = "per capita consumption", value = "value", -year)

ggplot(dt, aes(x = year, y = value)) + 
  labs(title = "U.S. Meat Consumption-pounds") +
  geom_line(aes(color = `per capita consumption`), size = 1) +
  scale_color_manual(values = c("orange", "lightblue", "lightgreen")) +
  theme_bw()+
  transition_reveal(year)

```


# Summary
